'use strict';var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}
var ProductCart=function(){function ProductCart(){_classCallCheck(this,ProductCart);this.products=JSON.parse(localStorage.getItem('PRODUCTS'));if(!this.products){this.products=[];}
this.totalProductscalc();this.addEventListeners();}
_createClass(ProductCart,[{key:'totalProductscalc',value:function totalProductscalc(){var products=this.products;var allProducts=0;$.each(products,function(index,value){var total_products=Number(products[index].product_quantity);allProducts+=total_products;});$('.products_quantity').text(allProducts);}},{key:'addEventListeners',value:function addEventListeners(){var mi=this;$('.add_to_cart').click(function(e){var buttonClicked=e.target;var buttonPressed=e.target.parentElement;var product_title=$(buttonPressed).children(".good_title").text();var product_price=$(buttonPressed).children("input[name='product_price']").val();var product_quantity=$(buttonPressed).children("[name='product_quantity']").val();var product_image=$(buttonPressed).children(".good_picture").attr('src');var product_id=$(buttonPressed).children("[name='product_id']").val();var product_quantity_block=$(buttonPressed).children("[name='product_quantity']");var newProduct={product_title:product_title,product_id:product_id,product_price:product_price,product_quantity:product_quantity,product_image:product_image};var z=mi.checkDoubles(newProduct);mi.addProduct(newProduct,z);buttonClicked.innerHTML="В корзине!";setTimeout(function(){buttonClicked.innerHTML="Купить";},1500);var counter=JSON.parse(sessionStorage.getItem('COUNTER'));console.log(counter);if(!counter){counter=1;}
if(counter==1){counter++;sessionStorage.setItem('COUNTER',JSON.stringify(counter));$('#popup2').show();$("#blindLayer").css("display","block");}else if(counter>1&&counter<3){window.location.href="cart.html";counter++;sessionStorage.setItem('COUNTER',JSON.stringify(counter));}else{console.log(counter);}});}},{key:'checkDoubles',value:function checkDoubles(newProduct,z){var products=this.products;var newProductId=newProduct.product_id;for(var _z=0;_z<products.length;_z++){if(products.length>0&&products[_z].product_id==newProductId){return _z;}}}},{key:'addProduct',value:function addProduct(newProduct,z){var products=this.products;var newProductQuantity=newProduct.product_quantity;if(z>=0){var product_quantity=Number(products[z].product_quantity)+Number(newProductQuantity);products[z].product_quantity=product_quantity;localStorage.setItem('PRODUCTS',JSON.stringify(this.products));}else{this.products.push(newProduct);localStorage.setItem('PRODUCTS',JSON.stringify(this.products));}
this.totalProductscalc();}}]);return ProductCart;}();var cart=void 0;window.addEventListener("load",function(){cart=new ProductCart();});